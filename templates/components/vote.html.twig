{%- set VOTE_NONE = constant('App\\Entity\\Contracts\\VoteInterface::VOTE_NONE') -%}

{% if app.user %}
    {%- set VOTE_UP = constant('App\\Entity\\Contracts\\VoteInterface::VOTE_UP') -%}
    {%- set VOTE_DOWN = constant('App\\Entity\\Contracts\\VoteInterface::VOTE_DOWN') -%}
    {%- set user_choice = is_granted('ROLE_USER') ? this.subject.userChoice(app.user) : null -%}

    {% set upUrl = path(this.formDest, {id: this.subject.id, choice: VOTE_UP}) %}
    {% set downUrl = path(this.formDest, {id: this.subject.id, choice: VOTE_DOWN}) %}

    {% if(user_choice is same as(VOTE_UP)) %}
        {% set choice = VOTE_UP %}
    {% elseif(user_choice is same as(VOTE_DOWN)) %}
        {% set choice = VOTE_DOWN %}
    {% else %}
        {% set choice = VOTE_NONE %}
    {% endif %}
{% else %}
    {% set upUrl = path(this.formDest, {id: this.subject.id, choice: VOTE_NONE}) %}
    {% set downUrl = path(this.formDest, {id: this.subject.id, choice: VOTE_NONE}) %}
{% endif %}

<aside{{ attributes.defaults({class: 'kbin-vote'}) }}>
    <form method="post" action="{{ upUrl }}">
        <button type="submit"
                class="kbin-vote__up"
                title="{{ 'up_vote'|trans }}"
                aria-label="{{ 'up_vote'|trans }}">
            <span>+</span> {{ this.subject.countUpvotes }}
        </button>
        <input type="hidden" name="token" value="{{ csrf_token('vote') }}">
    </form>
    {% if showDownvote %}
        <form method="post" action="{{ downUrl }}">
            <button type="submit"
                    class="kbin-vote__down"
                    title="{{ 'down_vote'|trans }}"
                    aria-label="{{ 'down_vote'|trans }}">
                <span>-</span> {{ this.subject.countDownvotes }}
            </button>
            <input type="hidden" name="token" value="{{ csrf_token('vote') }}">
        </form>
    {% endif %}
</aside>
