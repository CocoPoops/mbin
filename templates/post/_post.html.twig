{% block post %}
    {% from 'user/_macros.html.twig' import avatar %}
    {% from 'vote/_macros.html.twig' import vote %}
    {% from 'post/comment/_macros.html.twig' import comment %}

    <blockquote id="{{ post.id }}"
                class="kbin-post {{ extra_classes }} "
                data-embed-id-value="{{ post.id }}">
        <div class="kbin-post-header mb-2">
            {{ vote(post, {user: app.user, form_dest: 'post_vote', base_class: 'post', hide_downvote: true}) }}

            <div class="kbin-post-avatar">
                {{ avatar(post.user) }}
            </div>

            <aside class="kbin-post-meta">
                <ul class="kbin-post-meta-list list-inline m-0">
                    <li class="kbin-post-meta-date kbin-post-meta-list-item list-inline-item">
                        {% if not is_post_page() %}
                        <a href="{{ path('post_single', {'magazine_name': post.magazine.name, 'post_id': post.id}) }}">
                            {% endif %}
                            <small class="text-muted">dodany
                                <time>{{ post.createdAt|ago }}</time>
                            </small>
                            {% if not is_post_page() %}
                        </a>
                        {% endif %}
                    </li>

                    <li class="kbin-post-meta-user kbin-post-meta-list-item list-inline-item">
                        <small class="text-muted">przez
                            <a class="font-weight-bold" href="{{ path('user', {username: post.user.username}) }}">
                                {{ post.user.username }}
                            </a>
                        </small>
                    </li>

                    {% if not is_magazine_page() %}
                        <li class="kbin-comment-meta-magazine kbin-comment-meta-list-item list-inline-item">

                            <small class="text-muted">do <a class="font-weight-bold"
                                                            href="{{ path('front_magazine', {'name': post.magazine.name}) }}">/m/{{ post.magazine.name }}</a></small>
                        </li>
                    {% endif %}
                </ul>
            </aside>
        </div>
        <div class="kbin-post-main">
            <div class="kbin-post-content">
                {{ post.body|markdown|raw }}
            </div>
            <aside class="kbin-post-meta">
                <ul class="kbin-post-meta-list  list-inline mb-0">
                    <li class="kbin-post-meta-list-item kbin-post-meta-list-item-links list-inline-item">
                        <small class="text-muted">
                            <a data-action="post#reply"
                               class="{% if not (is_granted('ROLE_USER') ) %}kbin-login-alert kbin-link-block{% endif %}"
                               href="{{ path('post_single', {'magazine_name': post.magazine.name, 'post_id': post.id}) }}">
                                odpowiedz
                            </a>
                        </small>
                    </li>

                    {% if post.commentCount > 2 and not is_post_page() %}
                        <li class="kbin-post-meta-list-item kbin-post-meta-list-item-links list-inline-item">
                            <small class="text-muted">
                                <a data-action="post#showAllPosts"
                                   href="#">
                                    rozwiń ({{ post.commentCount }})
                                </a>
                            </small>
                        </li>
                    {% endif %}

                    <li class="kbin-post-meta-list-item kbin-post-meta-list-item-links list-inline-item">
                        <small class="text-muted">
                            <a href="#">link</a>
                        </small>
                    </li>

                    <li class="kbin-post-meta-list-item kbin-post-meta-list-item-links list-inline-item">
                        <small class="text-muted"><a href="#">zgłoś</a></small>
                    </li>

                    {% if is_granted('edit', post) %}
                        <li class="kbin-post-meta-list-item kbin-post-meta-list-item-links list-inline-item">
                            <small class="text-muted">
                                <a href="{{ path('post_edit', {'magazine_name': post.magazine.name, 'post_id': post.id}) }}">
                                    edytuj
                                </a>
                            </small>
                        </li>
                    {% endif %}
                </ul>
            </aside>
        </div>
        <div class="clearfix"></div>
    </blockquote>
    {% block before_comments %}{% endblock %}
    {% if(show_all_comments) %}
        {% for comment in comments %}
            {{ comment(comment) }}
        {% endfor %}
        {% if(comments.haveToPaginate) %}
            {{ pagerfanta(comments, null, {'pageParameter':'[strona]'}) }}
        {% endif %}
    {% endif %}

    {% if(show_best_comments) %}
        {% for comment in post.bestComments %}
            {{ comment(comment) }}
        {% endfor %}
    {% endif %}
{% endblock post %}
