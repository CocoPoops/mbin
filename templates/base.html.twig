<!doctype html>
<html lang="{{ app.request.locale }}">
<head>
    <title>{%- block title -%}{{- kbin_meta_title() -}}{%- endblock -%}</title>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="{{ kbin_meta_keywords() }}">
    <meta name="description" content="{% block description %}{{ kbin_meta_description() }}{% endblock %}">

    <meta property="og:url" content="{{ app.request.uri }}"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="{{ block('title')|trim }}"/>
    <meta property="og:description" content="{{ block('description')|trim }}"/>
    <meta property="og:image" content="{% block image %}{{ absolute_url(asset('kbin-og.png')) }}{% endblock %}"/>

    <link rel="shortcut icon" href="{{ asset('favicon.ico') }}">

    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {% block javascripts %}
        {% if kbin_js_enabled() %}
            <script>
                window.KBIN_LOGGED_IN = {{ app.user ? 'true' : 'false' }};
                window.KBIN_USERNAME = "{{ app.user ? app.user.username : null }}";
                window.KBIN_LOGIN = "{{ path('app_login') }}";
                window.MERCURE_PUBLISH_URL = "{{ mercure_public_url }}";
            </script>
            {{ encore_entry_script_tags('app') }}
        {% endif %}
    {% endblock %}
    <style>
        #kbin {
            background: url({{ asset('build/images/shape.png') }}); height: 100%;
        }

        {% if magazine is defined and magazine %}
            {{ magazine.customCss }}
        {% endif %}
    </style>
</head>

{% set theme = app.request.cookies.get('theme') ?? 'kbin-light' %}
{% if app.user %}
    {% set theme = app.user.theme is same as 'dark' ? 'kbin-dark' : 'kbin-light' %}
{% endif %}
<body class="{{ theme }}">
{% if magazine is defined and magazine %}
    <style>
        {{ magazine.customCss }}
    </style>
{% endif %}
<div data-controller="scroll-progress" class="scroll-progress"></div>
<div id="kbin"
     data-controller="kbin notify-counter"
     data-kbin-url-value="{{ path('user_profile_toggle_theme') }}"
     data-action="notify:Notification->notify-counter#notification notify:Message->notify-counter#message"
     data-notify-counter-hidden-class="v-hidden"
     data-turbo="{% if app.user and app.user.mode is same as 'turbo' %}true{% else %}false{% endif %}">
    <div class="fixed-top">
        {% if app.request.cookies.get('user_option_topbar') is same as 'true' %}
            {% include '_layout/_topbar.html.twig' %}
        {% endif %}
        {% include '_layout/_navbar.html.twig' %}
    </div>

    {% if not app.request.cookies.get('user_option_topbar') is same as 'true' %}
        {% include '_layout/_main_menu.html.twig' %}
    {% endif %}

    <section class="kbin-container container pt-3 mt-lg-5 pb-lg-5">
        <div class="mt-5 mt-lg-0">
            <div class="row">
                <main class="kbin-main col-lg-9 mb-5">
                    {% block body %}{% endblock %}
                </main>
                <aside class="col-lg-3 kbin-sidebar">
                    <div class="offcanvas offcanvas-end" id="kbin-sidebar">
                        <div class="d-block d-lg-none kbin-sidebar--close">
                            <button type="button" class="btn-close my-4 ms-1" data-bs-toggle="offcanvas"
                                    data-bs-target="#kbin-sidebar"
                                    aria-controls="kbin-nav" aria-expanded="false" aria-label="Toggle sidebar"></button>
                        </div>
                        <div class="mb-5 mt-5 d-lg-none">
                        </div>
                        {% include '_layout/_sidebar_mobile.html.twig' %}
                        {% block sidebar %}
                            {% include '_layout/_sidebar.html.twig' %}
                        {% endblock %}
                        {% block sidebar_bottom %}
                        {% endblock %}
                        {% block ads %}
                            {% if not is_admin_panel_page() %}
                                {{ component('ads') }}
                            {% endif %}
                        {% endblock %}
                    </div>
                </aside>
            </div>
        </div>
    </section>

    {% include '_layout/_footer.html.twig' %}

    <div class="toast-container position-absolute top-0 end-0 p-3">

    </div>

    {#    {% if kbin_js_enabled() and not app.request.cookies.get('cookie-info') %} #}
    {#        <div class="kbin-cookies" data-controller="cookie-info"> #}
    {#            <div class="container py-3 text-center"> #}
    {#                <p>Ta strona korzysta z ciasteczek (cookies), które używane są do obsługi logowania i zapamiętania motywu niezalogowanego #}
    {#                    użytkownika.</p> #}
    {#                <button data-action="click->cookie-info#close" type="button" class="btn btn-primary">Rozumiem</button> #}
    {#            </div> #}
    {#        </div> #}
    {#    {% endif %} #}

    <div aria-live="polite" aria-atomic="true" class="position-relative d-none d-lg-block">
        <div id="kbin-toast-container"
             class="kbin-toast-container toast-container position-fixed bottom-0 end-0 p-3 d-flex flex-column">

        </div>
    </div>
</div>
</body>
</html>
